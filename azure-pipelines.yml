# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- dev

pool:
  vmImage: 'ubuntu-16.04'

steps:
# - task: Maven@3
#   displayName: 'Maven build'
#   inputs:
#     mavenPomFile: 'trainer/pom.xml'
#     goals: 'clean install'
# - task: CopyFilesOverSSH@0
#   displayName: 'Copying to remote server'
#   inputs:
#     sshEndpoint: 'trainer'
#     sourceFolder: 'trainer/target/'
#     contents: 'trainer-1.0-SNAPSHOT.jar' 
#     targetFolder: '../home'
- task: SSH@0
  displayName: 'Shutting down trainer server'
  inputs:
    sshEndpoint: 'trainer'
    runOptions: inline
    inline: 'fuser -k 8080/tcp >/dev/null'
- task: SSH@0
  displayName: 'Starting trainer server'
  inputs:
    sshEndpoint: 'trainer'
    runOptions: inline
    inline: 'nohup java -jar ../home/trainer-1.0-SNAPSHOT.jar >/dev/null &'
    